<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Ågora - Inicio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="top-bar">
            <div class="logo">√Ågora</div>
            <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
            <nav>
                <ul class="top-nav">
                    <li><a href="#">Descubrir</a></li>
                    <li><a href="#">Blogs</a></li>
                    <li><a href="#">Soporte T√©cnico</a></li>
                    <li><a href="#"id="downloadButton">Descargar</a></li>
                    <li><a href="movil.html" class="button-link">Agora en tu M√≥vil</a></li>                    
                    <li><a href="#" onclick="abrirAgora()">Abrir √Ågora</a></li>
                    <li><a href="registro.html">Registrarse</a></li>
                    <li><a href="#" onclick="irALogin()">Iniciar sesi√≥n</a></li>

                    <!-- Men√∫ desplegable de usuario -->
                    <li id="userIcon" style="display: none;">
                        <a href="#" onclick="toggleUserMenu()">
                            <i class="fas fa-user"></i>
                        </a>
                        <ul id="userMenu" style="display: none;">
                            <li><a href="#">Perfil</a></li>
                            <li><a href="#" onclick="cerrarSesion()"><i class="fa-solid fa-sign-out-alt"></i></a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <script>
        // Mostrar icono de usuario si hay sesi√≥n iniciada
        window.onload = function() {
            if (localStorage.getItem('usuarioRegistrado') === 'true') {
                document.getElementById('userIcon').style.display = 'inline-block';
            }
        };

        // Funci√≥n para mostrar/ocultar el men√∫ de usuario
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        // Funci√≥n para cerrar sesi√≥n
        function cerrarSesion() {
            localStorage.removeItem('usuarioRegistrado');
            document.getElementById('userIcon').style.display = 'none'; // Ocultar el icono de usuario
            alert('Has cerrado sesi√≥n con √©xito');
            // Redirigir a la p√°gina de inicio de sesi√≥n
            window.location.href = 'index.html';
        }
    </script>

    <script>
        // Mostrar el mensaje de agradecimiento al descargar
        document.getElementById('downloadButton').addEventListener('click', function(event) {
            event.preventDefault(); // Evita que el enlace realice su acci√≥n por defecto
            alert('Gracias por descargar Agora y por confiar en nosotros');
        });
    </script>
    
    <div class="container">
        <aside class="sidebar">
            <ul>
                <li><a href="Tecnica.html">Producto</a></li>
                <li><a href="Tecnica.html">Compa√±ia</a></li>
                <li><a href="Tecnica.html">Pol√≠tica</a></li>
                <li><a href="Tecnica.html">Servicios</a></li>
            </ul>
        </aside>
        <script src="Menu.js"></script>
        <main>
            <section class="hero">
                <h6>.</h6>
                <img src="imagenes/banner.png" alt="√Ågora banner">
            </section>
            
            <section class="platforms">
                <h2>Disponible en</h2>
                <div class="platform-icons">
                    <a href="https://www.xbox.com" target="_blank">
                        <img src="imagenes/xbox.png" alt="Xbox">
                    </a>
                    <a href="https://www.playstation.com" target="_blank">
                        <img src="imagenes/playstation.png" alt="PlayStation">
                    </a>
                    <a href="https://www.microsoft.com/windows" target="_blank">
                        <img src="imagenes/windows.png" alt="Microsoft">
                    </a>
                    <a href="https://www.apple.com/ios" target="_blank">
                        <img src="imagenes/ios.png" alt="iOS">
                    </a>
                    <a href="https://www.android.com/intl/es_es/" target="_blank">
                        <img src="imagenes/android.png" alt="Android">

                    </a>
                </div>
            </section>
        </main>
    </div>

    <footer>
        <div class="footer-sections">
            <div>
                <h3>Caracteristicas</h3>
                <p><a href="SobreNosotros.html">Dise√±o</a></p>
                <p><a href="SobreNosotros.html">Prototipo</a></p>
                <p><a href="SobreNosotros.html">Colaboracion</a></p> 
            </div>
            <div>
                <h3>Comunidad</h3>
                <p><a href="SobreNosotros.html">Foros de discursion</a></p>
                <p><a href="SobreNosotros.html">Eventos de la comunidad</a></p>
                <p><a href="SobreNosotros.html">Historias</a></p>
            </div>
            <div>
                <h3>Equipo</h3>
                <p><a href="SobreNosotros.html">Nuestro equipo</a></p>
                <p><a href="SobreNosotros.html">Unete a Nosotros</a></p>
                <p><a href="SobreNosotros.html">Cultura y valores</a></p>
            </div>
        </div>
        <div class="social-icons">
            <a href="https://www.tiktok.com" target="_blank">
                <img src="imagenes/tiktok.png" alt="TikTok" class="social-icon">
            </a>
            <a href="https://www.instagram.com" target="_blank">
                <img src="imagenes/instagram.png" alt="Instagram" class="social-icon">
            </a>
            <a href="https://www.youtube.com" target="_blank">
                <img src="imagenes/youtube.png" alt="YouTube" class="social-icon">
            </a>
            <a href="https://www.facebook.com" target="_blank">
                <img src="imagenes/facebook.png" alt="Facebook" class="social-icon">
            </a>
        </div>
        <button class="download-btn">Descargar</button>
    </footer>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="Menu.js"></script>
    
    <script>
        // Funci√≥n para manejar "Abrir √Ågora"
        async function abrirAgora() {
            console.log('üöÄ Intentando abrir √Ågora...');
            
            // Verificar si hay una sesi√≥n activa
            const token = localStorage.getItem('agoraToken');
            console.log('üîç Token encontrado:', token ? 'S√ç' : 'NO');
            
            if (!token) {
                console.log('‚ùå No hay sesi√≥n activa, redirigiendo a login...');
                const loginUrl = 'iniciosesion.html?redirect=platform';
                console.log('üîó URL de login:', loginUrl);
                window.location.href = loginUrl;
                return;
            }
            
            try {
                // Verificar si el token es v√°lido
                if (typeof AgoraAPI !== 'undefined') {
                    console.log('üîç Verificando token...');
                    const isValid = await AgoraAPI.verifyToken();
                    console.log('üîç Token v√°lido:', isValid);
                    if (isValid.valid) {
                        console.log('‚úÖ Sesi√≥n v√°lida, accediendo a plataforma principal...');
                        window.location.href = 'agora-platform-demo.html';
                    } else {
                        console.log('‚ùå Token inv√°lido, redirigiendo a login...');
                        localStorage.removeItem('agoraToken');
                        window.location.href = 'iniciosesion.html?redirect=platform';
                    }
                } else {
                    console.log('‚ùå AgoraAPI no disponible, redirigiendo a login...');
                    window.location.href = 'iniciosesion.html?redirect=platform';
                }
            } catch (error) {
                console.error('üí• Error verificando sesi√≥n:', error);
                localStorage.removeItem('agoraToken');
                window.location.href = 'iniciosesion.html?redirect=platform';
            }
        }
        
        // Funci√≥n para manejar "Iniciar sesi√≥n"
        function irALogin() {
            console.log('üîê Redirigiendo a login para volver al index...');
            const loginUrl = 'iniciosesion.html?redirect=index';
            console.log('üîó URL de login:', loginUrl);
            window.location.href = loginUrl;
        }
        
        // Verificar sesi√≥n al cargar la p√°gina para mostrar el men√∫ de usuario
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('agoraToken');
            if (token && typeof AgoraAPI !== 'undefined') {
                AgoraAPI.verifyToken().then(result => {
                    if (result.valid) {
                        // Mostrar informaci√≥n del usuario logueado
                        console.log('‚úÖ Usuario logueado:', result.user);
                        // Aqu√≠ puedes mostrar el men√∫ de usuario si lo tienes
                        const userIcon = document.getElementById('userIcon');
                        if (userIcon) {
                            userIcon.style.display = 'block';
                        }
                    }
                }).catch(error => {
                    console.log('Token inv√°lido, limpiando...');
                    localStorage.removeItem('agoraToken');
                });
            }
        });
    </script>
</body>
</html>
